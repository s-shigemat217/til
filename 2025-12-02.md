
# 2025-12-01 スッキリわかるSQL入門 第4版②
## 第2部 SQLを使いこなそう
### Chapter5 式と関数
#### 5.1 式と演算子
##### 5.1.1 式の種類
結果が真や偽にならない式を計算式と呼ぶ。
##### 5.1.2 選択列リストで計算式を使う
SELECT文において、SELECTのすぐ後ろに指定するのが選択列リスト。選択列リストは、結果表にどのような列を出力するかを指定する役割がある。
▼選択列リストへのさまざまな指定
```SQL
SELECT 出金額,--列名
	   出金額 + 100,--計算式
	   'SQL' --固定値
   FROM 家計簿
```

**選択列リストへの指定と結果**
列名→列の内容がそのまま出力される
計算式→計算式の評価結果が出力される
固定値→固定値（リテラル）がそのまま出力される

##### 5.1.3 データの代わりに計算式を使う
▼INSERT文での計算式の利用
```SQL
INSERT INTO 家計簿（出金額）
VALUES (1000 + 105)
```
▼UPDATE文での計算式の利用（列指定を含む）
```SQL
UPDATE 家計簿
SET 出金額 = 出金額 + 100
```
##### 5.1.4 式が評価されるしくみ
**DBMSによる処理の原則**
- DBMSは、テーブル内の各行を1行ずつ順番に処理していく。
- 式の評価なども、各行で行われる。
#### 5.2 さまざまな演算子
##### 5.2.1 基本の算術演算子

| 演算子  | 使い方          | 説明           |
| ---- | ------------ | ------------ |
| ＋    | 数値＋数値        | 数値同士で足し算をする  |
|      | 日付＋数値        | 日付を指定日数だけ進める |
| ー    | 数値ー数値        | 数値同士で引き算をする  |
|      | 日付ー数値        | 日付を指定日数だけ戻す  |
|      | 日付ー日付        | 日付の差の日数を得る   |
| *    | 数値 * 数値      | 数値同士で掛け算をする  |
| /    | 数値 / 数値      | 数値同士で割り算     |
| \|\| | 文字列 \|\| 文字列 | 文字列を連結する     |

##### 5.2.2 CASE演算子 ー 値を変換する
CASE演算子は、列の値や条件式を評価し、その結果に応じて値を自由に変換してくれる。
**▼CASE演算子の利用構文（１）**
```SQL
CASE 評価する列や式 WHEN 値1 THEN 値1のときに返す値
				　WHEN 値2 THEN 値2のときに返す値
				　ELSE デフォルト値
END
```
▼CASE演算子を使ったSELECT文
```SQL
SELECT 費目, 出金額,
CASE 費目 WHEN '居住費' THEN '固定費'
		 WHEN '水道光熱費' THEN '固定費'
		 ELSE '変動費'
	END AS 出費の分類
	FROM 家計簿 WHERE 出金額 > 0
```

▼CASE演算子の利用構文(2)
```SQL
CASE WHEN 条件1 THEN 条件1のときに返す値
	 WHEN 条件2 THEN 条件2のときに返す値
	 ELSE デフォルト値
END
```
CASEのすぐ後ろに列名や式を記述しない代わりに、WHENの後ろには値ではなく条件式を指定する。
▼CASE演算子を使ったSELECT文(2)
```SQL
SELECT 費目, 入金額,
CASE WHEN 入金額 < 5000 THEN 'お小遣い'
	 WHEN 入金額 < 10000 THEN '一時収入'
	 WHEN 入金額 < 30000 THEN 'お給料'
	 ELSE '想定外の収入です'
END AS 収入の分類
FROM 家計簿
WHERE 入金額 > 0
```

CASE演算子は、式の結果に応じて複数のパターンの結果を得たい場合に有効。
#### 5.3 さまざまな関数

##### 5.3.1 関数とは
多くのデータベースには、より高度な処理を手軽に実現できる関数と総称される命令がたくさん準備されている。
すべての関数は「呼び出し時に指定した情報（引数）に対して、定められて処理を行い、結果（戻り値）に変換する」という動作をする。
##### 5.3.2 関数の使い方
**関数について定められていること**
- 名前：関数の名前
- 引数：関数を呼び出す時に引き渡す情報
- 戻り値：関数の呼び出し結果として得られる情報

**LENGTH関数の仕様**
- 名前：LENGTH
- 引数：文字列が格納された列（または式）
- 戻り値：文字列の長さを表す数値

▼メモとメモの長さを表示する
```SQL
SELECT メモ, LENGTH(メモ) AS メモの長さ
FROM 家計簿
```
##### 5.3.3 関数が動作する流れ
式の評価と同様に、関数の呼び出しも各行ごとに繰り返し行われる。
関数呼び出しの記述は、呼び出し完了後、戻り値に「化ける」。この特性を利用して、関数の呼び出しを入れ子にすることもできる。
##### 5.3.4 関数にまつわる注意点
日付型の取り扱いなどと並んで、**関数はDBMSごとの違いが大きく、互換性が少ない**分野。特定の製品でのみ利用可能な関数や、製品によって名前や動作が異なる関数も多く存在する。
#### 5.4 文字列にまつわる関数
##### 5.4.1 LENGTH／LEN ー 長さを得る
SQL Serverでは、LENGTHの代わりにLEN関数を利用。
テーブルの列に格納されている文字列の長さを取得したい、取得した長さを使って検索や更新したい、などの場合に利用する。
**▼文字列の長さを得る関数**
```SQL
LENGTH(文字列を表す列) → 文字列の長さを表す数値
LEN(文字列を表す列) → 文字列の長さを表す数値
```

**▼10文字（10バイト）以下のメモだけを取得する**
```SQL
SELECT メモ, LENGTH(メモ) AS メモの長さ FROM 家計簿
WHERE LENGHTH(メモ) <= 10
```

##### 5.4.2 TRIM ー 空白を除去する
**▼空白を除去する関数**
```SQL
TRIM(文字列を表す列) -> 左右から空白を除去した文字列
LTRIM(文字列を表す列) -> 左側の空白を除去した文字列
RTRIM(文字列を表す列) -> 右側の空白を除去した文字列
```

**▼空白を除去したメモを取得する**
```SQL
SELECT メモ, TRIM(メモ) AS 空白除去したメモ FROM 家計簿
```

##### 5.4.3 REPLACE ー 指定文字を置換する
**▼文字列を置換する関数**
```SQL
REPLACE(置換対象の文字列, 置換前の部分文字列, 置換後の部分文字列)　->　置換処理された後の文字列
```

**▼メモの一部を置換する**
```SQL
UPDATE 家計簿 SET メモ = REPLACE(メモ, '購入', '買った')
```

##### 5.4.4 SUBSTRING／SUBSTR ー 一部を抽出する
文字列の一部分だけを取り出したい場合には、SUBSTRING関数またはSUBSTR関数を利用
**▼文字列の一部を抽出する関数**
```SQL
SUBSTRING(文字列を表す列, 抽出を開始する位置, 抽出する文字の数) -> 抽出された部分文字列
SUBSTR(文字列を表す列, 抽出を開始する位置, 抽出する文字の数) -> 抽出された部分文字列
```
▼費目列の1〜3文字目に「費」があるものを抽出
```SQL
SELECT * FROM 家計簿
WHERE SUBSTRING(費目, 1, 3) LIKE '%費%'
```

##### 5.4.5 CONCAT ー 文字列を連結する
文字列を連結するには、通常、||演算子や+演算子を使うが、CONCAT関数でも同様の処理ができる。連結できる文字列の数やNULLの扱いがDBMSによって異なる点は注意。

**▼文字列を連結する関数**
```SQL
CONCAT（文字列, 文字列 [, 文字列…]） -> 連結後の文字列
```

▼費目とメモをつなげて抽出する
```SQL
SELECT CONCAT(費目, ':' || メモ) FROM 家計簿
```
#### 5.5 数値にまつわる関数
##### 5.5.1 ROUND ー 指定桁で四捨五入
**▼指定桁で四捨五入する関数**
```SQL
ROUND(数値を表す列, 有効とする桁数) -> 四捨五入した値
```

**▼百円単位の出金額を取得する（四捨五入）**
```SQL
SELECT 出金額, ROUND(出金額, -2) AS 百円単位の出金額 FROM 家計簿
```
ROUND関数に-2を渡すと、出金額の下2桁目、10の位で四捨五入してくれる。

##### 5.5.2 TRUNC ー 指定桁で切り捨てる
▼指定桁で切り捨てる関数
```SQL
TRUNC(数値を表す列, 有効とする桁数) -> 切り捨てた値
```

**▼百円単位の出金額を取得する（四捨五入）**
```SQL
SELECT 出金額, TRUNC(出金額, -2) AS 百円単位の出金額 FROM 家計簿
```
##### 5.5.3 POWER ー べき乗を計算する
**▼べき乗を計算する関数**
```SQL
POWER(数値を表す列, 何乗するかを指定する数値) -> 数値を指定した回数だけ乗じた結果
```
#### 5.6 日付にまつわる関数
##### 5.6.1 現在の日時を得る
**▼現在の日時を得る関数**
```SQL
CURRENT_TIMESTANP => 現在の日時（年、月、日、時、分、秒）
CURRENT_DATE => 現在の日付（年、月、日）
CURRENT_TIME => 現在の時刻（時、分、秒）
```

**▼現在の日付を取得して登録する**
```SQL
INSERT INTO 家計簿
VALUES (CURRENT_DATE,  '食費', 'ドーナッツを買った', 0, 260)
```
#### 5.7 変換にまつわる関数
##### 5.7.1 CAST ー データ型を変換する
**▼データ型を変換する関数**
```SQL
CAST(変換する値 AS 変換する型) => 変換後の値
```

##### 5.7.2 COALESCE ー 最初に登場するNULLでない値を返す
▼
```sql
COALESCE (列や式1, 列や式2, 列や式3...) => 引数のうち、最初に現れたNULLでない引数
```

#### 5.8 この章のまとめ
**計算式**
- 列やリテラルを使った式で、結果が真または偽にならないものを計算式という。
- 計算式を評価すると計算結果に化ける
- 計算式は、SELECT文の選択列リスト、INSERT文やUPDATE文のテーブルに格納する値、その他の修飾句など、様々な場所で使用できる。
**計算式に用いる演算子**
- 四則演算を行う演算子を算出演算子という
- || 演算子や+演算子で文字列の連結ができる。
- CASE演算子は、列の値や条件式を評価して、任意の値に変換する。
**関数**
- 関数は、引数に対して決められた処理を行い、戻り値に化ける
- 関数は、処理の内容や戻り値に応じて、文字列関数、算術関数、日付関数、変換関数などに分類される。
- 関数は、DBMSによる違いが大きい機能であるため、各製品のマニュアルなどで処理内容の確認が不可欠である。
### Chapter6 集計とグループ化
#### 6.1 データを集計する
##### 6.1.1 集計関数とは
集計関数を使うと、SELECT文による検索結果は該当する各業ではなく、該当する行が集計された形で出力されるようになる。
##### 6.1.2 集計関数の特徴
- 検索対象の全行をひとまとめに扱い、1回だけ集計処理を行う。
- 集計関数の結果は、必ず1行になる
#### 6.2 集計関数の使い方
##### 6.2.1 代表的な集計関数

| 関数名   | 説明           |
| ----- | ------------ |
| SUM   | 各行の値の合計を求める  |
| MAX   | 各行の値の最大値を求める |
| MIN   | 各行の値の最小値を求める |
| AVG   | 各行の値の平均値を求める |
| COUNT | 行数をカウントする    |
##### 6.2.2 合計、最大、最小、平均を求める
▼合計、最大値、最小値、平均値を求める集計関数
```SQL
SUM(列) => 合計
MAX(列) => 最大値
MIN(列) => 最小値
AVG(列) => 平均値
```
▼さまざまな集計をする
```SQL
SELECT SUM(出金額) AS 合計出金額,
	   AVG(出金額) AS 平均出金額,
	   MAX(出金額) AS 最も大きな散財,
	   MIN(出金額) AS 最も小学の支払い
FROM 家計簿
WHERE 出金額 > 0
```
##### 6.2.3 検索結果の行数を求める
▼行数を数える集計関数
```SQL
COUNT（*） => 検索結果の行数
COUNT（列） => 検索結果の指定列に関する行数
```

▼例
```SQL
SELECT COUNT (*) AS 食費の行数
FROM 家計簿
WHERE 費目 = '食費'
```

COUNT(\*) と COUNT(列) の違い
- COUNT(\*)は、単純に行数をカウントする（NULLの行数も含める）
- COUNT(列)は、指定列がNULLである行を無視してカウントする

**重複した値を除いた集計**
AVG,SUM,COUNTの各集計関数では、DISTINCTを指定すると、その行で重複している値を除いた状態で集計が行われる。
```SQL
SELECT COUNT(DISTINCT 費目) FROM 家計簿
```

#### 6.3 集計に関する4つの注意点
##### 6.3.1 SELECT文でしか利用できない
**集計関数が記述できる場所**：集計関数は、SELECT文の選択列リストかORDER BY句、HAVING句だけに記述できる。
##### 6.3.2 結果表が凸凹になってはならない
- 結果表は必ず長方形型になる
- 結果表が凸凹になるようなSQL文は実行できない。
	- 拡張機能として、結果表が凸凹でも値を補って動作するDBMSもある（MySQLなど）
##### 6.3.3 引数に許される型が異なる

| 関数名   | 数値型    | 文字列型        | 日付や時刻型  |
| ----- | ------ | ----------- | ------- |
| SUM   | 各数値の合計 | ✕           | ✕       |
| MAX   | 各数値の最大 | 並び替えて最後の文字列 | 最も新しい日時 |
| MIN   | 各数値の最小 | 並び替えて最初の文字列 | 最も古い日時  |
| AVG   | 各数値の平均 | ✕           | ✕       |
| COUNT | 行数     | 行数          | 行数      |
##### 6.3.4 NULLの取り扱い

| 集計関数        | 集計時のNULLの扱い         | 全行がNULLの場合の集計結果 |
| ----------- | ------------------- | --------------- |
| SUM         | 無視（Nullは集計に影響を与えない） | NULL            |
| MAX         | 無視（Nullは集計に影響を与えない） | NULL            |
| MIN         | 無視（Nullは集計に影響を与えない） | NULL            |
| AVG         | 無視（Nullは集計に影響を与えない） | NULL            |
| COUNT（\*指定） | Nullを含んでカウントする      | 該当行数            |
| COUNT（列名指定） | 無視（Nullは集計に影響を与えない） | 0               |
#### 6.4 データをグループにわける
##### 6.4.1 グループ別の集計
##### 6.4.2 グループ化
SQLには、集計に先立って、指定した基準で検索結果をいくつかのまとまりに分ける**グループ化**と呼ばれる機能が備わっている。集計はグループごとに行われ、グループごとの集計結果が結果表の形で得られる。
▼費目でグループ化してそれぞれの合計を求める
```SQL
SELECT 費目, SUM(出金額) AS 費目別の出金額合計
FROM 家計簿
GROUP BY 費目
```

▼ グループ化して集計する基本構文
```SQL
SELECT グループ化の基準列名…, 集計関数
FROM テーブル名
(WHERE 絞り込み条件)
GROUP BY グループ化の基準列名…
```

##### 6.4.3 グループ集計の流れ
グループ集計は、3つのステップで実行される。
第1ステップとして、元の表に対してWHERE句による通常の検索処理が行われ、行が絞り込まれる。
次に、GROUP BY句で指定された列に同じ値を持つ行ごとに、検索結果が分類される。最後に、各グループに対して集計関数の処理が行われた後、SELECT句の選択列リストによって列が絞り込まれ、結果表となる。
最終的な結果表の行数は、グループの数と等しくなる

**グループ化した集計関数**
- グループ化するには、GROUP BY句に基準となる列を指定する
- 集計関数は、データの値をグループごとにまとめて計算する
- 集計関数の結果表の行数は、必ずグループの数と一致する。

##### 6,4,4 グループ集計後の絞り込み
**集計関数はWHERE句に記述できない**
- 行を絞り込む段階では、まだ集計が終わっていないため、集計関数はWHERE句では利用できない
集計処理を行った後の結果表に対して絞り込みを行いたい場合は、WHERE区ではなくHAVING句を用いる。
▼集計結果に対して絞り込む基本構文
```SQL
SELECT グループ化の基準列名…, 集計関数
FROM テーブル名
(WHERE もとの表に対する絞り込み条件)
GROUP BY グループ化の基準列名…
HAVING 集計結果に対する絞り込み条件
```

▼集計結果で絞り込む
```SQL
SELECT 費目, SUM(出金額) AS 費目別の出金額合計
FROM 家計簿
GROUP BY 費目
HAVING SUM(出金額) > 0
```
##### 6.4.5 SELECT文の全貌
▼SELECT文の基本構文
```SQL
SELECT 選択列リスト
FROM テーブル名
[WHERE 条件式]
[GROUP BY グループ化列名]
[HAVING 集計結果に対する条件式]
[ORDER BY 並び替え列名]
```
#### 6.5 集計テーブルの活用
##### 6.5.1 大量のデータ集計
##### 6.5.2 集計テーブルの活用
非常に大量のデータを取り扱う場合、集計テーブルと呼ばれるテーブルを用いて、次のような工夫がなされることがある。
**集計テーブルの利用**
- あるテーブルの集計結果を格納するための別デーブル（集計テーブル）を作成する。
- 集計関数を用いて集計処理を1回行い、結果を集計テーブルに登録しておく。
- 集計結果が必要な場合は、すでに作った集計テーブルに格納されている計算済みの集計結果を利用する。
##### 6.5.3 集計テーブルを更新する
**集計テーブルを用いるリスク**
集計テーブルに格納されている内容は、最新のデータを用いた集計より古くなってしまう可能性がある。

**集計テーブルに不可欠な更新作業**
集計テーブルの内容が振るうなら内容に、定期的に再集計して内容を更新する作業が不可欠である。
#### 6.6 この章のまとめ
**集計**
- 集計関数を用いてデータを集計することができる。
- 集計関数は、まとめたグループごとに1つの結果を算出できる。
- 集計関数はSELECT文でのみ使用できる。
**グループ化**
- GROUP BY句にグループ分けの基準となる列を指定して、グループ別に集計を行うことができる。
- GROUP BY句を用いない集計では、検索結果の全件を1つのグループとして扱う。
- 集計値をもとにして特定のグループのみを抽出するには、HAVING句を用いる。

**集計関数**

| 関数名   | 集計の内容      | 集計できるデータ型    |
| ----- | ---------- | ------------ |
| SUM   | データを合計する   | 数値           |
| MAX   | 最も大きい値を求める | 数値、日付と時刻、文字列 |
| MIN   | 最も小さい値を求める | 数値、日付と時刻、文字列 |
| AVG   | データを平均する   | 数値           |
| COUNT | 行数をカウントする  | すべてのデータ型     |
### Chapter7 副問い合わせ
#### 7.1 検索結果に基づいて表を操作する
##### 7.1.1 2回のSELECTが必要な状況
▼最も大きな出費の費目と金額を求める①
```SQL
SELECT MAX(出金額) FROM 家計簿; =>（１）
SELECT 費目, 出金額 FROM 家計簿 WHERE 出金額 = 【（１）の値】;
```
##### 7.1.2 SELECTをネストする
▼最も大きな出費の費目と金額を求める②
```SQL
SELECT MAX(出金額) FROM 家計簿 WHERE 出金額 = (SELECT MAX(出金額) FROM 家計簿)
```
**副問合せとは**
ほかのSQL文の一部分として登場するSELECT文。丸括弧でくくって記述する
##### 7.1.3 副問合せを習得するコツ
- 副問い合わせが処理されるしくみを理解しておく
- 副問い合わせの代表的な3つのパターンを学んでおく
##### 7.1.4 コツその1 副問い合わせが処理されるしくみ
**副問い合わせの動作**
まず、内側にあるSELECT文が実行され結果に化ける。
そして外側のSQL文が実行される。
##### 7.1.5 コツその2 副問い合わせのパターン
**副問い合わせの3つのパターン**
- 単一の値の代わりとして、副問い合わせの検索結果を用いる。
- 複数の値の代わりとして、副問い合わせの検索結果を用いる。
- 表の値の代わりとして、副問い合わせの検索結果を用いる。

**データ構造の種類**
1つ以上のデータで形成されたものをデータ構造（data structure）といい、次の3つが基本になる。
- スカラー（単一の値）
- ベクター（1次元に並んだ値／配列）
- マトリックス（2次元に並んだ値／表）
#### 7.2 単一の値の代わりに副問合せを用いる
##### 7.2.1 単一行副問い合わせ
単一行副問い合わせとは
- 検索結果が1行1列の1つの値となる副問い合わせを指す。
- SELECT文の選択列リストやFROM句、UPDATE文のSET句、1つの値との判定を行うWHERE句の条件式などに記述できる。

##### 7.2.2 SET句で利用する
▼SET句で副問い合わせを利用する
```SQL
UPDATE 家計簿集計
SET 平均 = (SELECT AVG(出金額)
			FROM 家計簿アーカイブ
			WHERE 出金額 > 0
			AND 費目 = '食費')
WHERE 費目 = '食費'
```

##### 7.2.3 選択列リストで利用する
▼
```SQL
SELECT 日付, メモ, 出金額,
		(SELECT 合計 FROM 家計簿集計 WHERE 費目 = '食費') AS 過去の合計額
FROM 家計簿アーカイブ
WHERE 費目 = '食費'
```

#### 7.3 複数の値の代わりに副問合せを用いる
##### 7.3.1 複数行副問い合わせ
**複数行問い合わせとは**
- 検索結果がn行1列の複数の値となる副問い合わせを指す
- 複数の値との判定を行うWHERE句の条件式や、SELECT文のFROM句に記述できる。
##### 7.3.2 IN演算子で利用する
▼INを使った条件式
```SQL
SELECT * FROM 家計簿集計
WHERE 費目 IN ('食費', '水道光熱費', '教養娯楽費', '給料')
```

▼INで副問い合わせを利用する
```SQL
SELECT * FROM 家計簿集計
WHERE 費目 IN(SELECT DISTINCT 費目 FROM 家計簿)
```
##### 7.3.3 ANY／ALL演算子で利用する
```SQL
SELECT * FROM 家計簿
WHERE 費目 = '食費'
AND 出金額 < ANY (SELECT 出金額 FROM 家計簿アーカイブ WHERE 費目 = '食費')
```
##### 7.3.4 エラーとなる副問い合わせ
**複数行と比較したときは**
複数行副問い合わせは複数の値に化けるので、単なる等号や不等号では比較できない。等号や不等号にANY／ALL演算子を組み合わせたり、IN／NOT IN演算子を用いたりすればいい。

##### 7.3.5 副問い合わせとNULL
▼値リストにNULLのある条件式
```SQL
SELECT * FROM 家計簿 WHERE 費目 NOT IN('食費', '水道光熱費', NULL)
```
NOT IN演算子は、右辺に列挙された値を不等号を使って1つひとつ比較し、1つでもNULLが含まれると、NOT IN全体として「どの値とも明らかに等しくないか」は「不明」 となる。

**副問い合わせの結果にNULLを含む場合の落とし穴**
WHERE句などの絞り込みで、「結果にNULLを含む副問い合わせ」をNOT INや<>ALLと共に用いると、結果は0行となる。

**副問い合わせの結果から確実にNULLを除外する方法**
1. 副問い合わせの絞り込み条件に、IS NOT NULL条件を含める
2. COALESCE関数を使ってNULLを列の値に置き換える。

▼副問い合わせからNULLを除外する(1)
```SQL
SELECT * FROM 家計簿アーカイブ
WHERE 費目 IN (SELECT 費目 FROM 家計簿 WHERE 費目 IS NOT NULL)
```

▼副問い合わせからNULLを除外する(2)
```SQL
SELECT * FROM 家計簿アーカイブ
WHERE 費目 IN (SELECT COALESCE(費目, '不明') FROM 家計簿)
```
#### 7.4 表の代わりに副問合せを用いる
##### 7.4.1 表の結果となる副問い合わせ
- 検索結果がn行m列の表となる副問い合わせを指す。
- SELECT文のFROM句やINSERT文などに記述できる。
##### 7.4.2 FROM句で利用する
▼FROM句で副問い合わせを利用する
```sql
SELECT SUM(SUB.出金額) AS 出金額合計
FROM (
SELECT 日付, 費目, 出金額  FROM 家計簿
UNION
SELECT 日付, 費目, 出金額 FROM 家計簿アーカイブ
WHERE 日付 >= '2024-01-01' AND 日付 <= '2024-01-31') AS SUB
```

##### 7.4.3 INSERT文で利用する
副問い合わせを使えば1回のINSERT文で複数行のデータ登録が可能になる。
▼INSERT文で副問い合わせを利用する
```SQL
INSERT INTO 家計簿集計(費目, 合計, 平均, 回数)
SELECT 費目, SUM(出金額), AVG(出金額), 0
FROM 家計簿
WHERE 出金額 > 0
GROUP BY 費目
```

**単独で処理できない副問い合わせ**
```SQL
SELECT 費目, 合計 FROM 家計簿集計
WHERE EXISTS
(SELECT * FROM 家計簿 WHERE 家計簿.費目 = 家計簿.費目)
```
副問い合わせの内部から主問い合わせの表や列を利用する副問い合わせを、**相関副問い合わせ**という。常軌のように、「ほかのテーブルに値が登場する行のみ抽出したい」場合に、**EXISTS演算子**とともに使われる
```SQL
SELECT 列 FROM テーブルA
WHERE EXISTS
(SELECT * FROM テーブルB WHERE テーブルB.列 = テーブルA.列)
```
#### 7.5 この章のまとめ
**SQL文のネスト**
- SQL文の中に別のSELECT文を記述することができ、これを副問い合わせや副照会、またはサブクエリという。
- 副問い合わせは、実行すると何らかの値に置き換わる。
- 副問い合わせは、より内側にあるものから外側に向かって順に評価されていく。
**副問い合わせのパターン**
- 副問い合わせの結果が1行1列になるものを単一行副問い合わせという。
- 副問い合わせの結果がn行1列になるものを複数行行副問い合わせという。
- 副問い合わせの結果がn行m列の表形式なる副問い合わせも利用される
**複数行問い合わせと演算子**
- 複数行問い合わせは、IN、ANY、ALL演算子などと併せてよく用いられる
- 複数行副問い合わせの結果にNULLが含まれると、NOT IN、<>ALL演算子の評価結果もNULLとなる。
### Chapter8 複数テーブルの結合
#### 8.1 「リレーショナル」の意味
#### 8.2 テーブルの結合
#### 8.3 結合条件の取り扱い
#### 8.4 結合に関するさまざまな構文
#### 8.5 この章のまとめ
