
前回まででCRUDの一通りの実装についてやったので、課題用のToDoアプリを作ってみる。

MVCの作る順番について
1. モデル・マイグレーション(データ構造を決める) 
2. コントローラー(処理を書く) 
3. ビュー(画面を作る)

**メリット:**
- データ構造が明確になる
- コントローラーで何を渡すか決まる
- ビューは最後に整える
**このパターンが一番多いらしい**

教科書では１つ１つ順を追って作ったけど、実際どうなの？
#### 1. モデル・マイグレーション・コントローラーを一気に作る
````bash
# Model, Migration, Resource Controllerを一気に作成
php artisan make:model Todo -mcr
```

**オプションの意味:**
- `-m` = Migration作成
- `-c` = Controller作成
- `-r` = Resource Controller(7メソッド自動生成)

**作られるもの:**
1. `app/Models/Todo.php`
2. `database/migrations/xxxx_create_todos_table.php`
3. `app/Http/Controllers/TodoController.php`(リソースコントローラー)

**作られないもの:**
- ❌ ビューファイル

---

## ビューは自分で作る

### リソースコントローラーに対応するビュー

**必要なビューファイル:**
```
resources/views/todos/
  ├── index.blade.php   (一覧)
  ├── create.blade.php  (作成フォーム)
  ├── show.blade.php    (詳細)← TODOアプリでは不要かも
  └── edit.blade.php    (編集フォーム)
````

ビューファイルは自動では作られないので手動で作る。
#### 2. マイグレーションを編集して実行
先のコマンドで作成されたマイグレーションファイルを編集。
デフォルトではidとtimestampsの2カラムしかないので、必要なカラムを追加

**▼編集後のマイグレーションファイル**

```php
<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('todos', function (Blueprint $table) {
            $table->id();
            $table->foreignId('user_id')->constrained()->cascadeOnDelete();//TODOを作成したユーザーのID
            $table->string('title');//TODOのタイトル
            $table->text('description')->nullable();//TODOの詳細説明
            $table->boolean('is_completed')->default(false);//完了/未完了のフラグ
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('todos');
    }
};
```

```bash
# マイグレーションを実行
./vendor/bin/sail artisan migrate
```
#### 3. モデルの編集
▼作成されたモデル（/app/Models/Todo.php） は空っぽ
```PHP
<?php
namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Todo extends Model
{
//

}
```
classの中身を追記
```PHP
<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Factories\HasFactory;
use Illuminate\Database\Eloquent\Model;

class Todo extends Model
{
    use HasFactory;

    protected $fillable = [
        'title',
        'description',
        'is_completed',
    ];

    protected $casts = [
        'is_completed' => 'boolean',
    ];

    public function user()
    {
        return $this->belongsTo(User::class);
    }
}
```
1. protected $fillableで指定したカラムを一括代入許可
2. protected $casts でis_completedをboolean型として宣言
3. リレーションの設定
4. ファクトリの追加

▼ユーザーモデル（/app/Models/User.php）にToDoリレーションを追加
```PHP
<?php
	class User extends Authenticatable
	{
		public function todos() {
			return $this->hasMany(Todo::class);
		}
	}
```
1. 
#### 4.ルーティング設定
```PHP
<?php

use App\Http\Controllers\ProfileController;
use App\Http\Controllers\TodoController;  // ← 追加
use Illuminate\Support\Facades\Route;

Route::get('/', function () {
    return view('welcome');
});

Route::get('/dashboard', function () {
    return view('dashboard');
})->middleware(['auth', 'verified'])->name('dashboard');

Route::middleware('auth')->group(function () {
    Route::get('/profile', [ProfileController::class, 'edit'])->name('profile.edit');
    Route::patch('/profile', [ProfileController::class, 'update'])->name('profile.update');
	    Route::delete('/profile', [ProfileController::class, 'destroy'])->name('profile.destroy');
    
    // ↓↓↓ この1行を追加 ↓↓↓
    Route::resource('todos', TodoController::class);
});

require __DIR__.'/auth.php';
```
use文とリソースルートを追加。
これで、7つのルートが自動生成されTodoControllerと紐付けされる。
#### 5. コントローラーに処理を書く
```php
// app/Http/Controllers/TodoController.php
public function index()
{
    $todos = Todo::all();
    return view('todos.index', compact('todos'));
}
```

#### 4. ビューを作る
```bash
mkdir -p resources/views/todos
vim resources/views/todos/index.blade.php
```




# 本日の感想
ずっと無料の範囲で使ってたけど、ついにAIに課金してしまった…

