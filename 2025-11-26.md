# 2025-11-26 スッキリわかるSQL入門 第4版①
## 第1部 SQLを始めよう
### Chapter1 はじめてのSQL
#### 1.1 データベースとは
##### 1.1.1 データベースってなんだろう
データベースというとリレーショナルデータベース（RDB）のことを指す。
RDBの基本構造
- RDBには複数の表が入っており、それぞれの表をテーブルという
- 個々のテーブルには名前がついており、そのナマをテーブル名という
- テーブルは行（row）と列（column）で興世される
- 1つの行が1件のデータに対応する。列はそのデータの要素に対応する。
- 行をレコード、列をカラムやフィールドと飛ぶこともある。
##### 1.1.2 データベース管理システム（DBMS）
##### 1.1.3 代表的なRDBMS製品

| 分類   | RDBMS製品名        | 提供元                                 |
| ---- | --------------- | ----------------------------------- |
| 商用製品 | Oracle Database | オラクル社                               |
|      | Db2             | IBM                                 |
|      | SQL Server      | マイクロソフト                             |
| OSS  | MySQL           | オラクル社                               |
|      | MariaDB         | MariaDB Corporation                 |
|      | PostgreSQL      | PostgreSQL Global Development Group |
|      | SQLite          | D. Richard Hipp                     |
|      | H2 Database     | Thomas Mueller                      |

製品によって使用できるSQLの命令や記述方法には違いがあるが、基本的な構文や考え方は同じ。

##### 1.1.4 データベースにSQL分を送るには
#### 1.2 はじめてのSQL
##### 1.2.1 SQLを体験してみよう
##### 1.2.2 検索してみよう
##### 1.2.3 条件つきの検索
##### 1.2.4 データの追加
INSERT INTO テーブル名 VALUES 追加したいデータ
##### 1.2.5 データの更新
UPDATE テーブル名 SET データ WHERE 条件
##### 1.2.6 データの削除
DELETE FROM テーブル名 WHERE 条件

**3命令の動作**
- SELECT：ある条件を満たす行を探す→その行の内容を取得する
- UPDATE：ある条件を満たす行を探す→その行の内容を書き換える
- DELETE：ある条件を満たす行を探す→その行を削除する
#### 1.3 この章のまとめ
- データベースの概念
	- データベースとは、管理や分析を目的としてさまざまなデータを蓄積したもの
	- ITにおけるデータベースの実態は、通常、ファイルである。
	- データベースはデータベース管理システム（DBMS）によって管理される。
	- 現在、さまざまなDBMSがソフトウェア製品として公開されている。
	- 複数のテーブルの形式でデータを管理するものをリレーショナル・データベースという。
	- テーブルには名前がついており、行と列から構成される。
	- 1つの行が1件のデータ、1つの列がデータの1要素に対応している。
- SQLの概要
	- SQLは、データベースやデータを操作するための専用言語。
	- SQLで書かれた命令（SQL文）をDBMSに送信すると、データの検索・追加・更新・削除などを行うことができる。
	- SQLを送信するには、DBMS製品が提供するドライバを用いたプログラムをあたしく開発するか、DBMS製品に付属するソフトウェア（SQLクライアント）を利用する。
	- SQLの文法は利用するDBMS製品によって少しずつ異なるが、基本的な部分は同じである。
#### 1.4 練習問題

### Chapter2 基本文法と4大命令
#### 2.1 SQLの基本ルール
##### 2.1.1 記述形式に関するルール
- 文の途中に改行を入れることができる
- 行の先頭や行の途中に半角の空白を入れることができる
##### 2.1.2 コメントに関する2つのルール
- ハイフン2つ（‐‐）から行末まではコメントとして扱われる。
- /* から * / まではコメントとして扱われる
##### 2.1.3 予約語に関するルール
- SELECTやWHEREなどの命令に使う単語は、SQLとして特別な意味を持つ「予約語」である。
- 予約後は、大文字と小文字のどちらで記述しても良い。
- テーブル名や列名に予約語を利用することはできない
#### 2.2 データ型とリテラル
##### 2.2.1 リテラルの種類
- シングルクォーテーションでくくらずに記述されたリテラルは、数値情報として扱われる
- シングルクォーテーションでくくられたリテラルは、基本的に文字情報として扱われる。
- シングルクォーテーションでくくられ、かつ'2024-02-25'のように一定の形式で記述されたリテラルは、日付情報として扱われる。
##### 2.2.2 列とデータ型
- テーブルの各列には、データ型が指定されている。
- 列には、データ型で指定された種類の情報のみ格納できる。
- 利用可能なデータ型は、DBMS製品によって異なる。
##### 2.2.3 固定長と可変長
- CHAR型→固定長
- VARCHAR型→可変長
#### 2.3 SQLの命令体型
##### 2.3.1 4つの重要な命令
ほとんどのデータ層は、SELECT、UPDATE、DELETE、INSERTの4つの命令で実現できる。
これら4つのSQL命令は、DML（Data Manipulation Language）と総称される。
##### 2.3.2 4大命令の全体像を俯瞰する
#### 2.4 SELECT文ーデータの検索
##### 2.4.1 SELECT文の基本構造
```SQL
SELECT 列名…
FROM テーブル名
(WHERE修飾)
(その他の修飾)
```
##### 2.4.2 ASによる別名の定義
それぞれの記述の牛とに**AS**と任意のキーワードを付けて、別名を定義できる。
```SQL
SELECT 費目 AS ITEM, 入金額 AS RECEIVE, 出金額 AS PAY
FROM 家計簿 AS MONEYBOOK
WHERE 費目 = '給料'
```
**列に別名を付けるメリット**
- 状況に応じて、結果表のタイトル列を任意の内容で表示できる。
- 英語名などの一見わかりにくい列名や長い列名でも、わかりやすく短い別名を付けてSQL文の中で利用できる
#### 2.5 UPDATE文 ー データの更新
##### 2.5.1 UPDATE文の基本構造
```SQL
UPDATE テーブル名
SET 列名1 = 値1, 列名2 = 値2…
(WHERE 修飾)
```

**WHEREのないUPDATE文は全件更新になってしまうよ。**
#### 2.6 DELETE文 ー データの削除
##### 2.6.1 DELETE文の基本構造
```SQL
DELETE 
FROM テーブル名
(WHERE 修飾)
```
DELETE文では列名を指定する必要がないため、1行目のDELETEの後ろには何も記述しない。
**==WHERE句のDELETE命令は全件削除==**
#### 2.7 INSERT文 ー データの追加
##### 2.7.1 INSERT分の基本構造
```SQL
INSERT INTO テーブル名
			（列名1, 列名2, 列名3…）
		VALUE （値1, 値2, 値3…）
```
#### 2.8 4大命令をスッキリ学ぶコツ
##### 2.8.1. 4大命令を振り返って
- 4大命令の構造と修飾語の全体像をしっかり把握する。
- 4大命令の2通りの分類方法を理解する
- 4大命令に共通するテーブル指定を先に書く
##### 2.8.2. 4大命令の2通りの分類を理解する
**分類方法（1）検索系と更新系**
- 検索系→SELECT
- 更新系→UPDATE, DELETE, INSERT
分類方法（2）既存系と心奇形
- 既存系→SELECT, UPDATE,DELETE
- 心奇形→INSERT

##### 2.8.3. テーブル指定を先に記述する
**4大命令のすべてに共通すること：処理対象とするテーブル名を必ず指定する必要がある。**
**▼スッキリかけるSQL**
1. まず、命令（SELECT, UPDATE, DELETE, INSERT）を記述する。
2. 次に、テーブル指定の部分を記述する
3. テーブル指定より後ろの部分を記述する
4. テーブル指定より前の部分を記述する（SELECT文のみ）
#### 2.9 この章のまとめ
**SQLの基本ルール**
- 記述の途中で開業したり、半角の空白を入れたりしてもよい。
- 予約後は大文字、小文字が区別されない。また、列名などに利用できない。
- 文中にコメントを記述することができる
**データ型とリテラル**
- SQL分の中に直接記述される具体的な値をリテラルという。
- 数値、文字列、日付など、データの種類に応じてリテラルの記述方法は異なる。
- テーブルの各列にはデータ型が指定されている。
- 列に指定された種類のデータのみ、その列に格納することができる。
**SQLの体系**
- SELECT, UPDATE,DELETE, INSERTの4つの命令を利用する。
- 各命令をどのように実行するかを指示する修飾が豊富に用意されており、組み合わせることによって多様な命令を実現できる。
- 4つの命令は、操作内容から見た検索系と更新系、対象とするデータ絡みた既存系と新規系に分類できる。
**4大命令をスッキリ学ぶコツ**
- 4大命令の構造と修飾語の全体像をしっかり把握する。
- 4大命令の2通りの分類方法を理解する。
- SQL文を作成するときは、4大命令に共通するテーブル指定を先に書く。



### Chapter3 操作する行の絞り込み
#### 3.1 WHERE句による絞り込み
##### 3.1.1 WHERE句の大切さ
**WHERE句を自由自在に使えて初めて、データを自由自在に操作することができる**
##### 3.1.2 WHERE句の基本
1. 処理対象業の絞り込みに用いる
   →WHEREを指定しないと「すべての行」が処理対象になる
2. SELECT, UPDATE,DELETE文で使用可能
   →新しい行を追加するINSERT文では使用できない
3. WHEREの後ろには条件式を記述する。
   →絞り込み条件に沿った「正しい条件式」を記述する

#### 3.2 条件式
##### 3.2.1 真と偽
WHERE句に書けるものは、結果が必ず真（True）か偽（False）となる条件式
##### 3.2.2 WHERE句の仕組み
#### 3.3 さまざまな比較演算子
##### 3.3.1 基本の演算子
##### 3.3.2 NULLの判定
**NULLとは**
- そこに何も値が格納されていない状態を意味する、特別なもの。
- 数値のゼロや空白文字、長さ0の文字列とも異なる存在
- 格納データが「不明」や「無意味」である状況を示す意図で用いられる。

NULLであることを判定するためにはIS NULL演算子、NULLでないことを判定するためにはIS NOT NULL演算子を使う。

▼例
```SQL
SELECT *
FROM 家計簿
WHERE 出金額 IS NULL
```
##### 3.3.3 LIKE演算子
文字列があるパターンに合致しているかのチェックをパターンマッチングという。
SQLではパターンマッチングにLIKE演算子を使う
▼例
```SQL
SELECT * FROM 家計簿
WHERE メモ LIKE '%1月%'
```
LIKE演算子に使えるパターン文字

| パターン文字 | 意味           |
| ------ | ------------ |
| %      | 任意の0文字以上の文字列 |
| _      | 任意の1文字       |
パターン文字列の中で、単なる文字として%や_を使うにはESCAPE句を併用する
```SQL
SELECT * FROM 家計簿 WHERE メモ LIKE '%1月$%' ESCAPE '$'
```
ESCAPE句で指定した文字（上の例では$）をエスケープ文字といい、この文字に続く％や＿は、パターン文字ではなくただの文字として扱われる。

##### 3.3.4 BETWEEN演算子
ある範囲内に値が収まっているかを判定する。
▼例：500〜900円の出費を取得するSELECT文
```SQL
SELECT *
FROM 家計簿
WHERE 出金額 BETWEEN 500 AND 900
```

##### 3.3.5 IN/NOT IN演算子
IN演算子は、カッコ内に列挙した複数の値のいずれかにデータが合致するかを判定する演算子。
=演算子では、1つの値との比較しかできないが、IN演算子を使えば、一度にたくさんの値との比較が可能。
▼例：
```SQL
SELECT *
FROM 家計簿
WHERE 費目 IN （'食費', '交際費'）
```

▼例：
```SQL
SELECT *
FROM 家計簿
WHERE 費目 NOT IN （'食費', '交際費'）
```

##### 3.3.6 ANY/ALL演算子
複数の値と「大小」を比較したい場合には、ANY演算子やALL演算子を使う。

- 値リストのそれぞれと比較して、いずれかが真なら真
  式　基本比較演算子　ANY　（値1, 値2, 値3 ...）
- 値リストのそれぞれと比較して、すべて真なら真
  式　基本比較演算子　ALL　（値1, 値2, 値3 ...）

**同じ意味になる演算子**
- NOT INと<>ALLはどの値とも一致しないことを判定する演算子
- INと=ANYはいずれかの値と一致することを判定する演算子
#### 3.4 複数の条件式を組み合わせる
##### 3.4.1 論理演算子
**AND演算子とOR演算子**
- 2つの条件式の療法が真の場合だけ、真となる（AかつB）
  条件式1 AND 条件式2
- 2つの条件式のどちらかが真ならば、真となる（AまたはB）
  条件式1 OR 条件式2

NOT演算子：条件式の結果について、真は偽に、偽は真に逆転させる性質を持つ。
##### 3.4.2 論理演算子の優先度
複数の論理演算子が使われている場合、NOT→AND→ORの優先順位で処理される。
条件式を（）でくくると、評価の優先順位が上がる
#### 3.5 主キーとその必要性
##### 3.5.1 思い通りに削除できない
##### 3.5.2重複した行を識別する方法
**主キーとなる列が持つべき特性**
- 必ず何らかのデータが格納される（NULLではない）。
- ほかの行と値が重複しない。
- 一度決めた値は変化しない。
**すべてのテーブルは主キーとなる列を必ず持つべき**

##### 3.5.3 主キー列を作り出す
自然キー：主キーの役割を果たすことのできる、「社員番号」のような列
人口キー/代替キー：管理目的のためだけに人工的に追加された列

##### 3.5.4 複数の列で行を識別する
単独では重複の可能性がある列でも、複数の列を組み合わせれば重複する可能性が実質的になるなる場合がある。複数の列を1つの主キーとするものを複合主キー（composite key）という。
#### 3.6 この章のまとめ
**WHERE句** 
- WHERE句は、SELECT, UPDATE,DELETE文で使うことができる
- WHERE句に記述した条件式によって、対象データを絞り込むことができる。
- 条件式で真に評価されるデータが処理の対象となる。
**演算子**
- 条件式には比較演算子と論理演算子を記述できる。
- 論理演算子は、NOT、AND、ORの順で優先度が高く、先に評価される。
**NULL**
- NULLは、値が不明または無意味であるためにデータが格納されていない状態を表す。
- NULLを判定するには、イコール記号ではなく、IS NULLとIS NOT NULLを用いる。
**主キー**
- 主キーによって、テーブル内のひとつひとつの行が識別可能になる。
- 主キーとなる列には、重複しない値が必ず格納される必要がある。
- 自然キーが存在しないバアは、人口キーを追加して識別可能にする
- 複数の列を組み合わせて複合主キーを構成し、行を識別できる。


### Chapter4 検索結果の加工

