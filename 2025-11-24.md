前回の続きでLaravelでToDoアプリ作っていく。


#### 5. コントローラーの処理を実装

**の前に、必要なビューファイルを作成**
▼ビューが必要なメソッド（GETリクエスト）
- `index()` - 一覧を表示 → `todos/index.blade.php`
- `create()` - 作成フォームを表示 → `todos/create.blade.php`
- `edit()` - 編集フォームを表示 → `todos/edit.blade.php`
- `show()` - 詳細を表示 → `todos/show.blade.php`

##### 1. `index()` - ToDoの一覧表示
▼コントローラ
```php
public function index()
{
    // ログイン中のユーザーのToDoを全件取得
    $todos = auth()->user()->todos()->latest()->get();
    return view('todos.index', compact('todos'));
}
```
**解説:**
- `auth()->user()` - ログイン中のユーザーオブジェクトを取得
- `->todos()` - Userモデルで定義した`hasMany`リレーションで、そのユーザーに紐づくToDoを取得
- `->latest()` - 最新順（降順）でソート。デフォルトではcreated_atでソート
- `->get()` - 実際にDBからデータを取得（これがないとクエリは実行されない）
- `view('todos.index', compact('todos'))` - `resources/views/todos/index.blade.php`を表示し、`$todos`変数を渡す

**ユースケース:** ユーザーが「/todos」にアクセスすると、自分のToDoが新しい順に一覧表示される

ところで、
「->」この書き方、JavaScriptのアローに似てるけどPHPだとどういう意味？
 **ChatGPT:**`->` は **PHP の「オブジェクトのプロパティ・メソッドへアクセスする記号」**
JSでいうところの「.」のようなもの。

---
##### 2. `create()` - 作成フォーム表示
```php
public function create()
{
    return view('todos.create');
}
```
**解説:**
- シンプルに`resources/views/todos/create.blade.php`を表示するだけ
- ここではDBアクセスは不要
- フォーム上で入力された内容は`store()`メソッドで処理される

**ユースケース:** ユーザーが「/todos/create」にアクセスすると、ToDoを作成するためのフォームが表示される



教科書でFlux使ってたから同じようにFlux使おうとしたところページに反映されていない。

**1. Fluxがインストールされているか確認** **2. Fluxのアセット（CSS/JS）がビルドされていない**
```bash
npm run dev
```

このコマンドでフロントエンドのアセット（CSSやJavaScript）がビルドされます。

**それでも反映されない場合：**
```bash
npm list @flux-framework/flux
```

このコマンドを実行して、Fluxがインストールされているか確認したところ入ってない。
```bash
npm install @flux-framework/flux
```
インストールを実行したがエラー

```bash
npm error code E404 npm error 404 Not Found - GET [https://registry.npmjs.org/@flux-framework%2fflux](https://registry.npmjs.org/@flux-framework%2fflux) - Not found npm error 404 npm error 404 '@flux-framework/flux@*' is not in this registry.
```
どうやらパッケージが存在しないらしい。
教科書ではLivewireに備わってると書かれてるが、そもそもLivewire入ってるのか。

**Livewireがインストールされているか確認**
```bash
npm list livewire
```

**入ってなかったのでインストール：**
```bash
composer require livewire/livewire
```

インストール後ビルドをしたけども、画面に反映されず。
```bash
composer require livewire/flux
```
https://fluxui.dev/docs/installation にあるインストールコマンド実行で入ったみたい。
画面への反映が確認できた。



---
##### 3. `store()` - フォームデータをDBに保存
```php
public function store(Request $request)
{
    // バリデーション
    $validated = $request->validate([
        'title' => 'required|string|max:255',
        'description' => 'nullable|string',
    ]);

    // ログイン中のユーザーのToDoとして作成
    auth()->user()->todos()->create($validated);

    return redirect()->route('todos.index')->with('message', 'ToDoを作成しました。');
}
```

**バリデーションの詳細:**
- `'title' => 'required|string|max:255'`
    - `required` - titleは必須（空では不可）
    - `string` - 文字列型であること
    - `max:255` - 最大255文字まで
- `'description' => 'nullable|string'`
    - `nullable` - nullを許可（空白でOK）
    - `string` - 文字列型であること

**バリデーションエラー時の動作:** バリデーションに引っかかるとエラーメッセージがセッションに保存され、前のページにリダイレクトされる

**ToDoの作成:**
```php
auth()->user()->todos()->create($validated);
```
- `auth()->user()` - ログイン中のユーザー
- `->todos()` - そのユーザーのToDoリレーション
- `->create($validated)` - バリデーション済みのデータでToDoを作成
    - 自動的に`user_id`がセットされる（リレーションを使用しているため）

**リダイレクトとメッセージ:**
```php
return redirect()->route('todos.index')->with('success', 'ToDoを作成しました。');
```
- `redirect()->route('todos.index')` - `/todos`にリダイレクト
- `->with('success', 'ToDoを作成しました。')` - セッションにメッセージを保存
    - ビューで`{{ session('success') }}`で表示できる

**ユースケース:** ユーザーが作成フォームで「保存」ボタンを押すと、バリデーションされてDBに保存され、一覧ページにリダイレクト